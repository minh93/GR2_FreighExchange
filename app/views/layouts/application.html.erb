<!DOCTYPE html>
<html>
<head>
  <title>GR2FreighExchange</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <%= link_to image_tag("img_home.png"), root_path, class: "navbar-brand", style: "margin-bottom: 10px" %>
      </div>
      <% if current_user.role == "supplier" %>
      <div>  <%= link_to "You have " + (Request.where(:status => "none").count - Invoice.where(:supplier_id => Supplier.select(:supplier_id).find_by_user_id(current_user.id)).count).to_s + " request(s)", supplier_profile_path %></div><br />
      <div>abc <%= Invoice.where(:supplier_id => (Supplier.select(:supplier_id).find_by_user_id(current_user.id)), :status => "accepted").count%></div>
      <% end %>

      <% if current_user.role == "customer" %>
      <div> 
       <td> <%= link_to "You have " + Invoice.where(:request_id => (Request.select(:request_id).where(:customer_id => Customer.select(:customer_id).find_by_user_id(current_user.id))), :status => "pending").count.to_s + " response(s)", customer_invoices_path %> </td>
       
      </div>
      <% end %>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">        
          <% if !@breadcrumb.nil? %>
            <% @breadcrumb.each do |item| %>
              <li><a><%= item %><span class="glyphicon glyphicon-menu-right"></span></a></li>
            <% end %>
          <% end %>
        </ul>

        <ul class="nav navbar-nav navbar-right">
          <% if user_signed_in? %>
            <li><%= link_to gravatar_for(current_user, size: 24), root_path %></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
              aria-expanded="false">
              Hi!&nbsp<%= current_user.email %>
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <li><a href="#">Mail box</a></li>
              <li><%= link_to "Logout", destroy_user_session_path, method: :delete %></li>
              <li><%= link_to "Account setting", customer_profile_path %></li>
              <li role="separator" class="divider"></li>
              <li><a href="#">Separated link</a></li>
            </ul>
          <% else %>
            <li>
              <%= link_to "Login", new_user_session_path %>
            </li>
          <% end %>
        </ul>
      </div>    
    </div>
  </nav>

  <div class="container" id="app-area">
    <div class="row">
      <% flash.each do |message_type, message|%>
      <div class="alert alert-<%=message_type%>">
        <%= message %>
      </div>
      <% end %>
    </div>
    <div class="row">
      <%= yield %>
    </div>

</body>
</html>
